more function, more netsted loops
